{% extends 'moderatorpanel/base.html' %}

{% load static %}

{% block title %}Questions{% endblock %}

{% block page_heading %}

<div>
    Questions
    <div class="page-title-subheading">This is an example dashboard created using build-in elements and components.
    </div>

</div>

{% endblock %}


{% block dashboard %}



<!-- <h3 class="">{{ question.status|title }} Question</h3> -->

<div class="container">
  <div class="search-wrapper mb-4 ml-1 active">
      <div class="input-holder">
        <form method="GET" action="{% url 'moderator:get_questions' 0 %}" style="text-decoration: none;">
          <input id="search-input" type="text" class="search-input" placeholder="Type to search" name="search">
          <button type="submit" class="search-icon" id="search-button"><span></span></button>
        </form>
      </div>
      <!-- <button class="close"></button> -->
  </div>
<div class="row">


{% for question in questions %}

  <div class = "col col-md-6 col-xl-4"> 
    <div id = "replaceable-content" class="main-card mb-3 card" style="height: 385px; position:relative;">
        <div class="card-body">
          {% if question.author.user == request.user %}
          <div class="dropdown d-inline-block mt-1" style="position: absolute; top:0px; right: 0px;">
                <button type="button" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-outline-link"></button>
                <div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 33px, 0px);">
                  <!-- <a href="{% url 'moderator:edit_question' question.id %}" style="text-decoration: none;"> -->
                        <button type="button" tabindex="0" class="dropdown-item js-edit-question" data-toggle="modal" data-target="#modal-book"  data-url="{% url 'moderator:edit_question' question.id %}">Edit</button>
                      <a href="{% url 'moderator:delete_question' question.id %}" style="text-decoration: none;">
                        <button type="button" tabindex="0" class="dropdown-item">Delete</button></a>
                </div>
            </div>
            {% endif %}
            <h5 class="card-title mr-1" 
                style="overflow: hidden;
                      text-overflow: ellipsis;
                      display: -webkit-box;
                      -webkit-line-clamp: 5;
                      -webkit-box-orient: vertical;
                      font-size: 16px;
                      text-transform: none;"
            >
            <a href="{% url 'moderator:answer_page' question.id %}" style="text-decoration: none; color: #4c4c4c;"> 
              {{question.content|title}}  
            </a>              
            </h5>
            
          <p class="card-subtitle">
                <div class="mb-2 mr-2 badge badge-pill badge-success">{{question.category}}</div>
                {% for keyword in question.keywords_associated.all %}
            <div class="mb-2 mr-2 badge badge-pill badge-info">{{keyword}}</div>
                {% endfor %}
                
            </p>

            <div class="widget-content p-0">
                <div class="widget-content-wrapper">
                  <div class="widget-content-left">
                    <div class="btn-group">
                      <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="p-0 btn">
                        <img width="42" class="rounded-circle" src="/static/moderatorpanel/images/avatars/1.jpg" alt="">
                      </a>
                                
                    </div>
                  </div>
                  <div class="widget-content-left  ml-3 header-user-info">
                    <div class="widget-heading">
                      {{question.author}}
                    </div>
                    <div class="widget-subheading">
                      {{question.author.profession}}
                    </div>
                  </div>
                        
                </div>
            </div>  <p></p>
            <p style="position: absolute; bottom: 20px;">
                Total Answers : {{question.answer_count}}
              <div style="position: absolute; bottom: 35px; right: 25px;">
              <i class="fa fa-heart m-1" aria-hidden="true" title="Copy to use thumbs-up">&nbsp;</i>{{question.like_count}}
              <i class="fa fa-fw m-1" aria-hidden="true" title="Copy to use arrow-up"></i> {{question.upvote_count}}
              <i class="fa fa-fw m-1" aria-hidden="true" title="Copy to use arrow-down"></i> {{question.downvote_count}}</div>
            </p>
            
        </div>
  </div>
  </div>


{% endfor %}
 
      
  </div>

</div>


<!-- For Poll Questions -->


<!-- <h3>{{ question.status|title }} Question</h3> -->
<div class="container">
<div class="row">
{% for question in questions %}
{% if question.type == 'poll' %}

  <div class = "col col-md-6 col-xl-4"> 
    <div class="main-card mb-3 card" style="height: 385px; position: relative;">
        <div class="card-body">
            <h5 class="card-title mr-1" 
                style="overflow: hidden;
                      text-overflow: ellipsis;
                      display: -webkit-box;
                      -webkit-line-clamp: 3;
                      -webkit-box-orient: vertical;
                      color: #4c4c4c;"
            >
              {{question.content}}  
            
              
            </h5>
            
          <p class="card-subtitle">
                <div class="mb-2 mr-2 badge badge-pill badge-success">{{question.category}}</div>
              {% for keyword in question.keywords_associated.all %}
            <div class="mb-2 mr-2 badge badge-pill badge-info">{{keyword}}</div>
                {% endfor %}
              {% if question.author.user == request.user %}
                <div class="dropdown d-inline-block ">
                    <button type="button" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-outline-link"></button>
                    <div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 33px, 0px);">
                      <a href="{% url 'moderator:edit_question' question.id %}" style="text-decoration: none;">
                        <button type="button" tabindex="0" class="dropdown-item">Edit</button></a>
                      <a href="{% url 'moderator:delete_question' question.id %}" style="text-decoration: none;">
                       <button type="button" tabindex="0" class="dropdown-item">Delete</button></a>
                    </div>
                </div>
            {% endif %}
              <div class="row">
                 
                <div class="col col-md-6">
                  <div class="widget-content">
                    <div class="widget-content-outer">
                      <div class="widget-content-left fsize-1">
                            <div class="text-muted opacity-6">Totals Target</div>
                        </div>
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left pr-2 fsize-1">
                                <div class="widget-numbers mt-0 fsize-1 text-info">89%</div>
                            </div>
                            <div class="widget-content-right w-100">
                                <div class="progress-bar-xs progress">
                                    <div class="progress-bar bg-info" role="progressbar" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100" style="width: 89%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="col col-md-6">
                  <div class="widget-content">
                    <div class="widget-content-outer">
                      <div class="widget-content-left fsize-1">
                            <div class="text-muted opacity-6">Totals Target</div>
                        </div>
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left pr-2 fsize-1">
                                <div class="widget-numbers mt-0 fsize-1 text-info">89%</div>
                            </div>
                            <div class="widget-content-right w-100">
                                <div class="progress-bar-xs progress">
                                    <div class="progress-bar bg-info" role="progressbar" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100" style="width: 89%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <div class="row">
                <div class="col col-md-6">
                  <div class="widget-content">
                    <div class="widget-content-outer">
                      <div class="widget-content-left fsize-1">
                            <div class="text-muted opacity-6">Totals Target</div>
                        </div>
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left pr-2 fsize-1">
                                <div class="widget-numbers mt-0 fsize-1 text-info">89%</div>
                            </div>
                            <div class="widget-content-right w-100">
                                <div class="progress-bar-xs progress">
                                    <div class="progress-bar bg-info" role="progressbar" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100" style="width: 89%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="col col-md-6">
                  <div class="widget-content">
                    <div class="widget-content-outer">
                      <div class="widget-content-left fsize-1">
                            <div class="text-muted opacity-6">Totals Target</div>
                        </div>
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left pr-2 fsize-1">
                                <div class="widget-numbers mt-0 fsize-1 text-info">89%</div>
                            </div>
                            <div class="widget-content-right w-100">
                                <div class="progress-bar-xs progress">
                                    <div class="progress-bar bg-info" role="progressbar" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100" style="width: 89%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              
              
            

            <div class="widget-content p-0">
                <div class="widget-content-wrapper">
                  <div class="widget-content-left">
                    <div class="btn-group">
                      <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="p-0 btn">
                        <img width="42" class="rounded-circle" src="/static/moderatorpanel/images/avatars/1.jpg" alt="">
                      </a>
                                
                    </div>
                  </div>
                  <div class="widget-content-left  ml-3 header-user-info">
                    <div class="widget-heading">
                      {{question.author.fullname}}
                    </div>
                    <div class="widget-subheading">
                      {{question.author.profession}}
                    </div>
                  </div>
                        
                </div>
            </div>  <p></p>
            <p style="position: absolute; bottom: 20px;">
                Total Answers : {{question.answer_count}}
                <div style="position: absolute; bottom: 35px; right: 25px;">
                <i class="fa fa-heart" aria-hidden="true" title="Copy to use thumbs-up">&nbsp;</i>{{question.like_count}}
              <i class="fa fa-fw" aria-hidden="true" title="Copy to use arrow-up"></i> {{question.upvote_count}}
              <i class="fa fa-fw" aria-hidden="true" title="Copy to use arrow-down"></i> {{question.downvote_count}}</div>
            </p>
            
        </div>
  </div>
  </div>
        
   {% endif %} 
{% endfor %}
 

</div>

</div>


{% endblock %}

{% block js %}

<script type="text/javascript">
  
  const search_input = $("#search-input")
  // const questions = $('#replaceable-content')
  const endpoint = "{% url 'moderator:get_questions' 0 %}"
  // const delay_by_in_ms = 700
  // let scheduled_function = false

  // $("#search-button").click(function(){
  //   $.ajax({
  //     url: endpoint,
  //     data: search_input.value,
  //     dataType: 'json',
  //     success:
  //   })
  // });

  // let ajax_call = function (endpoint, request_parameters) {
  //     $.getJSON(endpoint, request_parameters)
  //         .done(response => {
  //             // fade out the questions, then:
  //             questions.fadeTo('slow', 0).promise().then(() => {
  //                 // replace the HTML contents
  //                 questions.html(response['html_from_view.content'])
  //                 // fade-in the div with new contents
  //                 questions.fadeTo('slow', 1)
  //             })
  //         })
  // }


  // search_input.on('keyup', function () {

  //     const request_parameters = {
  //         q: $(this).val() // value of search_input: the HTML element with ID search-input
  //     }

  //     // if scheduled_function is NOT false, cancel the execution of the function
  //     if (scheduled_function) {
  //         clearTimeout(scheduled_function)
  //     }

  //     // setTimeout returns the ID of the function to be executed
  //     scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
  // })


 // $("#search-input").change(function(){

 //    var search_input = $(this).val();

 //    $.ajax({
 //      url: '{% url "moderator:get_questions" 0 %}'
 //      data:{
 //        'q':search_input
 //      },
 //      dataType: 'json',
 //      success: function(data){
 //        if(data.questions){

 //        }
 //      }
 //    })

 // })

</script>






{% endblock %}